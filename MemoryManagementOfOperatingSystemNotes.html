<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>操作系统笔记之内存管理 | Syficy</title><meta name="description" content="操作系统笔记之内存管理"><meta name="keywords" content="操作系统,理论笔记"><meta name="author" content="Shen Yufan"><meta name="copyright" content="Shen Yufan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="操作系统笔记之内存管理"><meta name="twitter:description" content="操作系统笔记之内存管理"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606709740439-j5yyww.jpg"><meta property="og:type" content="article"><meta property="og:title" content="操作系统笔记之内存管理"><meta property="og:url" content="https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes"><meta property="og:site_name" content="Syficy"><meta property="og:description" content="操作系统笔记之内存管理"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606709740439-j5yyww.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes"><link rel="prev" title="给N1安上armbian，不止于nas" href="https://blog.syficy.com/N1andArmbian.html"><link rel="next" title="操作系统笔记之进程管理" href="https://blog.syficy.com/OperatingSystemProcessManagement.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?76b593d307526ad348ac878fb45457c2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-0NPGDG66XL', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.syficy.com","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: {"languages":{"author":"Author: Shen Yufan","link":"Link: https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes","source":"Source: Syficy","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Syficy</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">4</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Background"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Background</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Address-Binding"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Address Binding</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#types-of-adress-binding"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">types of adress binding</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-compile-time"><span class="toc_mobile_items-number">3.1.1.</span> <span class="toc_mobile_items-text">1. compile time</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-load-time"><span class="toc_mobile_items-number">3.1.2.</span> <span class="toc_mobile_items-text">2. load time</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-Excution-time"><span class="toc_mobile_items-number">3.1.3.</span> <span class="toc_mobile_items-text">3. Excution time</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#methods"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">methods</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#MMU-gt-Memory-Management-Unit"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">MMU-&gt; Memory-Management Unit</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Dynamic-Loading"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">Dynamic Loading</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Static-Linking"><span class="toc_mobile_items-number">3.2.3.</span> <span class="toc_mobile_items-text">Static Linking</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Dynamic-Linking"><span class="toc_mobile_items-number">3.2.4.</span> <span class="toc_mobile_items-text">Dynamic Linking</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#swapping-P282"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">swapping (P282)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Contiguous-Memory-Allocation-（P284）"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">Contiguous Memory Allocation （P284）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#memory-allocation"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">memory allocation</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#paging-p288"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">paging (p288)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#pagetable"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">pagetable</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#logical-address"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">logical address</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Hardware-Support-TLB"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">Hardware Support: TLB</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Memory-Protection"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">Memory Protection</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Shared-Pages"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">Shared Pages</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#page-table-memory-structure"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">page table memory structure</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Segmentation"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">Segmentation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#The-Intel-Pentium-P305"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">The Intel Pentium (P305)</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Background"><span class="toc-number">2.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Address-Binding"><span class="toc-number">3.</span> <span class="toc-text">Address Binding</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#types-of-adress-binding"><span class="toc-number">3.1.</span> <span class="toc-text">types of adress binding</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-compile-time"><span class="toc-number">3.1.1.</span> <span class="toc-text">1. compile time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-load-time"><span class="toc-number">3.1.2.</span> <span class="toc-text">2. load time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Excution-time"><span class="toc-number">3.1.3.</span> <span class="toc-text">3. Excution time</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#methods"><span class="toc-number">3.2.</span> <span class="toc-text">methods</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MMU-gt-Memory-Management-Unit"><span class="toc-number">3.2.1.</span> <span class="toc-text">MMU-&gt; Memory-Management Unit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-Loading"><span class="toc-number">3.2.2.</span> <span class="toc-text">Dynamic Loading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Static-Linking"><span class="toc-number">3.2.3.</span> <span class="toc-text">Static Linking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-Linking"><span class="toc-number">3.2.4.</span> <span class="toc-text">Dynamic Linking</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swapping-P282"><span class="toc-number">4.</span> <span class="toc-text">swapping (P282)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Contiguous-Memory-Allocation-（P284）"><span class="toc-number">5.</span> <span class="toc-text">Contiguous Memory Allocation （P284）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#memory-allocation"><span class="toc-number">5.1.</span> <span class="toc-text">memory allocation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#paging-p288"><span class="toc-number">6.</span> <span class="toc-text">paging (p288)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pagetable"><span class="toc-number">6.1.</span> <span class="toc-text">pagetable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logical-address"><span class="toc-number">6.2.</span> <span class="toc-text">logical address</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hardware-Support-TLB"><span class="toc-number">6.3.</span> <span class="toc-text">Hardware Support: TLB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Memory-Protection"><span class="toc-number">7.</span> <span class="toc-text">Memory Protection</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shared-Pages"><span class="toc-number">8.</span> <span class="toc-text">Shared Pages</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#page-table-memory-structure"><span class="toc-number">9.</span> <span class="toc-text">page table memory structure</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Segmentation"><span class="toc-number">10.</span> <span class="toc-text">Segmentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Intel-Pentium-P305"><span class="toc-number">11.</span> <span class="toc-text">The Intel Pentium (P305)</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606709740439-j5yyww.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">操作系统笔记之内存管理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2020-12-02<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-12-08</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文是操作系统内存管理的学习笔记</p>
<p>Overview:  </p>
<pre><code>1. Background
2. Address Binding
3. Swapping
4. Contiguous Alocation
5. Paging
6. Memory Protection
7. Shared Pages
8. Page table memory structure
9. Segmentation
10. The Intel Pentium</code></pre><h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>Main memory和register是Cpu唯二可以直接访问的地方，程序需要brought into Main memory来提高效率。因此在一个程序中，我们需要使用地址绑定【Address Binding】<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606895258563-1606895258548.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="Multistep processing of a user program" class="fancybox"><img alt="Multistep processing of a user program" title="Multistep processing of a user program" data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606895258563-1606895258548.png" class="lazyload"></a>  </p>
<p>这张图介绍了程序的生命周期: Compiler -&gt; link -&gt; load -&gt; run.</p>
<h1 id="Address-Binding"><a href="#Address-Binding" class="headerlink" title="Address Binding"></a>Address Binding</h1><h2 id="types-of-adress-binding"><a href="#types-of-adress-binding" class="headerlink" title="types of adress binding"></a>types of adress binding</h2><h3 id="1-compile-time"><a href="#1-compile-time" class="headerlink" title="1. compile time"></a>1. compile time</h3><p>早期在编译时就决定数据位置，编译器将符号码翻译为绝对码和绝对地址，如果开始地址变化（在runtime可能把程序从内存移到硬盘），就需要重新编译。</p>
<h3 id="2-load-time"><a href="#2-load-time" class="headerlink" title="2. load time"></a>2. load time</h3><p>Load: 把code从disk move to main memory<br>编译时新增一个基准地址baseaddress，在load时才根据baseaddress来决定最终的地址。但是在move后需要重新load和run，不过不需要重新complie。因此load time 的 address binding还是做不到 runtime的move。</p>
<h3 id="3-Excution-time"><a href="#3-Excution-time" class="headerlink" title="3. Excution time"></a>3. Excution time</h3><p>Compiler translated symbolic code into logical-address(virtual-address) code.<br>通过使用虚拟地址，实现运行时转换。<br>由于大量的程序都需要进行转换，使用软件很慢，因此需要用到硬件计算，即独立的硬件MMU来实现 this scheme。<br>目前大部分操作系统使用此 scheme。</p>
<h2 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h2><h3 id="MMU-gt-Memory-Management-Unit"><a href="#MMU-gt-Memory-Management-Unit" class="headerlink" title="MMU-&gt; Memory-Management Unit"></a>MMU-&gt; Memory-Management Unit</h3><p><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606897258435-1606897258426.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="MMU的工作原理图" class="fancybox"><img alt="MMU的工作原理图" title="MMU的工作原理图" data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606897258435-1606897258426.png" class="lazyload"></a></p>
<p>用户程序只需要处理逻辑地址，它是无法知晓物理地址的。</p>
<h3 id="Dynamic-Loading"><a href="#Dynamic-Loading" class="headerlink" title="Dynamic Loading"></a>Dynamic Loading</h3><p>由于我们的程序往往会调用一堆内存却不用，造成浪费。因此需要使用dynamic-loading技术来减少浪费。<br>每个routine只在被called的时候才被load into memory<br>Better memory-space utilization: 不使用的routine不load到memory。<br>以下图为例，只有使用到的函数才被called，退出函数后从main memory退出。<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606900798208-1606900798193.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606900798208-1606900798193.png" class="lazyload"></a></p>
<h3 id="Static-Linking"><a href="#Static-Linking" class="headerlink" title="Static Linking"></a>Static Linking</h3><p>Libraries are combined by the loader into the program inmemory image.<br>把所有的libraries导入到memory时，导致 memory的waste(重复的代码)，但是可以Faster during execution time。</p>
<h3 id="Dynamic-Linking"><a href="#Dynamic-Linking" class="headerlink" title="Dynamic Linking"></a>Dynamic Linking</h3><p>Dynamic linking: Linking postpned until execution time， 即需要时再link，<br>在windows中常见的DDL（Dynamic link library）就是这种方式。但是速度会比较慢，因为需要子程序去查询调用DDL。</p>
<h1 id="swapping-P282"><a href="#swapping-P282" class="headerlink" title="swapping (P282)"></a>swapping (P282)</h1><p>A process can be swapped out of memory to a <strong>backing store</strong>(midterm scheduling), and later brought back into memory for continuous execution.  </p>
<blockquote>
<p>backing store: a chunk of disk, separated form file system, to provide direct access to these memory images.</p>
</blockquote>
<p>通过swap, 可以减少内存消耗，同时也可以让重要的程序先用，不重要的先不用。<br>swap程序时，程序必须是idle的，即不使用io阶段。就是说不用io且不用cpu的程序才能swapped. 为了防止io时swapped，有两种解决方案，1是io时坚决不swap，2是通过OSbuffers，将io资料暂存在OSbuffers中，这也是最常见的解决方案。</p>
<h1 id="Contiguous-Memory-Allocation-（P284）"><a href="#Contiguous-Memory-Allocation-（P284）" class="headerlink" title="Contiguous Memory Allocation （P284）"></a>Contiguous Memory Allocation （P284）</h1><p>连续内存调用  </p>
<h2 id="memory-allocation"><a href="#memory-allocation" class="headerlink" title="memory allocation"></a>memory allocation</h2><p>内存partition可以分为：<br>fixed partition<br>variable-size partition</p>
<p>How to satisfy a request of size n from a list of free holes:</p>
<ol>
<li>First fit. Allocate thefirst hole that is big enough. Searching can start either at the beginning of the set of holes or vvhere the previous first-fit search ended. we can stop searching as soon as ‘INe find a free hole that is large enough.</li>
<li>Best fit. Allocate the smallest hole that is big enough. We must search the entire list, unless the list is ordered by size. This strategy produces the smallest leftover hole.</li>
<li>Worst fit. Allocate the largest hole. Again, we must search the entire list,unless it is sorted by size. This strategy produces the largest leftover hole, which may be more useful than the smaller leftover hole from a best-fit approach. </li>
</ol>
<p>但是仍然会造成空间的浪费，这种内存的空间浪费称之为 Fragmentation</p>
<p>Fragmentation 惨遭程序在内存中的位置可以分为 External fragmentation 和  Internal fragmentation。</p>
<p>对于Fragmentation的解决方案是 Compation。</p>
<h1 id="paging-p288"><a href="#paging-p288" class="headerlink" title="paging (p288)"></a>paging (p288)</h1><p>内存分块，物理层面(physical memory)上的分块称为frames；<br>在逻辑层面(logical adress space)称为pages。</p>
<p>paging的过程有：</p>
<ol>
<li>keep track of free frames</li>
<li>page table</li>
</ol>
<h2 id="pagetable"><a href="#pagetable" class="headerlink" title="pagetable"></a>pagetable</h2><p>Each entry maps to the base address of a page in physical memory<br>每个程序有自己的pagetable。<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903026372-1606903026359.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="Paging model of logical and physical memory" class="fancybox"><img alt="Paging model of logical and physical memory" title="Paging model of logical and physical memory" data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903026372-1606903026359.png" class="lazyload"></a></p>
<p>为了增加内存可用率，使用不连续内存读写，其中paging是主流用法，paging使用fix-partition。</p>
<h2 id="logical-address"><a href="#logical-address" class="headerlink" title="logical address"></a>logical address</h2><p>Logical address is divided into two parts:</p>
<ol>
<li><p>Page number: N bits</p>
</li>
<li><p>Page offset: 2^N bits</p>
</li>
</ol>
<p>Physical address = page base addr + page offset</p>
<p>下面这两道例题可以很好的解释以上相关关系的概念<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903733330-1606903733315.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903733330-1606903733315.png" class="lazyload"></a></p>
<p><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903999047-1606903999033.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606903999047-1606903999033.png" class="lazyload"></a></p>
<p>使用Free-frame list 来管理free的frame：<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606904134324-1606904134311.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606904134324-1606904134311.png" class="lazyload"></a></p>
<p>page size 是由硬件决定的。<br>如果page size小了，会导致page number增多，page table 也会变大，程序需要读多个page。如果多了，会导致浪费概率增加，因此一般是4kb/8kb。</p>
<h2 id="Hardware-Support-TLB"><a href="#Hardware-Support-TLB" class="headerlink" title="Hardware Support: TLB"></a>Hardware Support: TLB</h2><p>类似于crash的原理，对常访问内存地址单独建表，书上介绍如下:<br>The standard solution to this problem is to use a special, small, fast-<br>lookup hardware cache, called a translation look-aside buffer ( TLB ).</p>
<p><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606906058945-1606906058940.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606906058945-1606906058940.png" class="lazyload"></a></p>
<p>计算案例如下：<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606906544756-1606906544747.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606906544756-1606906544747.png" class="lazyload"></a><br>当命中时时间等于TLB+accessMemory,未命中时时间等于TLB+accessMemory+accessMemory.</p>
<h1 id="Memory-Protection"><a href="#Memory-Protection" class="headerlink" title="Memory Protection"></a>Memory Protection</h1><p>Each page is associated with a set of protection bit in the page table.<br>也就是说每个page都会有一bit来定义读写执行的权限。这个bit称之为Valid-Invalid Bit.</p>
<h1 id="Shared-Pages"><a href="#Shared-Pages" class="headerlink" title="Shared Pages"></a>Shared Pages</h1><p>Paging allows process share common code ,which must be reentrant, Two virtual address are mapped to oen physical address. page的好处就是可以只把共用的code部分进行映射。</p>
<h1 id="page-table-memory-structure"><a href="#page-table-memory-structure" class="headerlink" title="page table memory structure"></a>page table memory structure</h1><p>page table 可能变得很大，内存中很难找到连续的一块这么大的空间。因此要想方设法把pagetable变小。主要有以下几种方法： </p>
<ol>
<li>把pagetable切小，分散放，这种方法称之为Hierarchical Paging</li>
<li>Hashed Page Table</li>
<li>Inverted Page Table,使用frame table （PID, Page NUmber）</li>
</ol>
<h1 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h1><p>Segmentation is a memory-management scheme that supports this user view of memory. A logical address space is a collection of segments. Each segment has a name and a length. The addresses specify both the segment name and the offset within the segment. The user therefore specifies each address by two quantities: a segment name and an offset. (Contrast this scheme with the paging scheme, in which the user specifies only a single ad.dress, which is partitioned by the hardware into a page number and an offset, all invisible to the progranmler.)</p>
<p>Segment level: shared memory communication and shared library  </p>
<p>以下是现在操作系统中的常见结构：<br><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606911948335-1606911948313.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606911948335-1606911948313.png" class="lazyload"></a></p>
<p><a href="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606912024035-1606912024025.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606912024035-1606912024025.png" class="lazyload"></a></p>
<h1 id="The-Intel-Pentium-P305"><a href="#The-Intel-Pentium-P305" class="headerlink" title="The Intel Pentium (P305)"></a>The Intel Pentium (P305)</h1></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Shen Yufan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes.html">https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统    </a><a class="post-meta__tags" href="/tags/%E7%90%86%E8%AE%BA%E7%AC%94%E8%AE%B0/">理论笔记    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606709740439-j5yyww.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/N1andArmbian.html"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606709655393-r2g7rm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>给N1安上armbian，不止于nas</span></div></a></div><div class="next-post pull_right"><a href="/OperatingSystemProcessManagement.html"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606712239174-43vvmv.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>操作系统笔记之进程管理</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/OperatingSystemProcessManagement.html" title="操作系统笔记之进程管理"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/syficy/assets/picture/1606712239174-43vvmv.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-12-02</div><div class="relatedPosts_title">操作系统笔记之进程管理</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="disqus_thread"></div><link href="https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqus.js"></script><script>var dsqjs = new DisqusJS({
  shortname: 'syficyblog',
  siteName: "syficyblog",
  identifier: 'MemoryManagementOfOperatingSystemNotes.html',
  url: 'https://blog.syficy.com/MemoryManagementOfOperatingSystemNotes.html',
  title: '操作系统笔记之内存管理',
  api: 'https://disqus.skk.moe/disqus/',
  apikey: 'lSAoCSYP1mOgqyhD6xLyWqEnSDmGglWJwQvWnc50QyKMUhgVSUmkTlxwKKYalqkm',
  admin: '',
  adminLabel: ''
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Shen Yufan</div><div class="framework-info"><span></span></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>浙ICP备19006500号-2</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/ClickShowText.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>